"use strict";angular.module("couchtvApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngLoadingScreen"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/movie/:id",{templateUrl:"views/movie.html",controller:"MovieCtrl"}).when("/genre/:id",{templateUrl:"views/genre.html",controller:"GenreCtrl"}).when("/latest",{templateUrl:"views/latest.html",controller:"LatestCtrl"}).when("/discover",{templateUrl:"views/discover.html",controller:"DiscoverCtrl"}).when("/coomingsoon",{templateUrl:"views/coomingsoon.html",controller:"CoomingsoonCtrl"}).when("/toprated",{templateUrl:"views/toprated.html",controller:"TopratedCtrl"}).when("/person/:id",{templateUrl:"views/person.html",controller:"PersonCtrl"}).otherwise({redirectTo:"/"})}]).controller("AppCtrl",["$scope","$filter","$location","tmdb",function(a,b,c,d){a.showLoader=!0,a.$watch("searchField",function(b){b?d.getSearch(b).then(function(b){console.log(a.movies),a.movies=b.results}):a.movies=[]}),d.getGenres().then(function(b){a.genres=b.genres,a.showLoader=!1}),$("#menu-toggle").click(function(a){var b=$(this);b.text(b.text()===b.data("text-swap")?b.data("text-original"):b.data("text-swap")),a.preventDefault(),$("#wrapper").toggleClass("toggled")}),a.isActive=function(a){var b=a===c.path();return b}}]),angular.module("couchtvApp").controller("MainCtrl",["$scope","$http","$rootScope","tmdb",function(a,b,c,d){d.getPopular().then(function(b){a.images=b.results}),d.getUpcoming().then(function(b){a.upComing=b.results}),d.getDiscover().then(function(b){a.the_discoveries=b.results}),a.$watch("searchField",function(b){b?d.getSearch(b).then(function(b){a.movies=b.results}):a.movies=[]})}]),angular.module("couchtvApp").factory("tmdb",["$resource","$http","$q",function(a,b,c){var d="http://api.themoviedb.org/3",e="api_key=08edb5883bdbd866cb7b58d656f3c66c";return{getSearch:function(a){var f=c.defer();return b.get(d+"/search/movie?query="+encodeURIComponent(a)+"&"+e,{}).success(function(a){f.resolve(a)}),f.promise},getLatest:function(){var a=c.defer();return b.get(d+"/movie/now_playing?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getPopular:function(){var a=c.defer();return b.get(d+"/movie/popular?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getTopedRated:function(){var a=c.defer();return b.get(d+"/movie/top_rated?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getGenres:function(){var a=c.defer();return b.get(d+"/genre/movie/list?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getGenreById:function(a){var f=c.defer();return b.get(d+"/genre/"+a+"/movies?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getDiscover:function(){var a=c.defer();return b.get(d+"/discover/movie?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getUpcoming:function(){var a=c.defer();return b.get(d+"/movie/upcoming?"+e,{}).success(function(b){a.resolve(b)}),a.promise},getTrailers:function(a){var f=c.defer();return b.get(d+"/movie/"+a+"/videos?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getReviews:function(a){var f=c.defer();return b.get(d+"/movie/"+a+"/reviews?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getSimilar:function(a){var f=c.defer();return b.get(d+"/movie/"+a+"/similar?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getCredits:function(a){var f=c.defer();return b.get(d+"/movie/"+a+"/credits?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getPerson:function(a){var f=c.defer();return b.get(d+"/person/"+a+"?"+e,{}).success(function(a){f.resolve(a)}),f.promise},getPersonCredits:function(a){var f=c.defer();return b.get(d+"/person/"+a+"/movie_credits?"+e,{}).success(function(a){f.resolve(a)}),f.promise}}}]),angular.module("couchtvApp").service("getMovie",["$http","$routeParams",function(a,b){return{async:function(){return a.get("http://api.themoviedb.org/3/movie/"+b.id+"?api_key=08edb5883bdbd866cb7b58d656f3c66c")}}}]).controller("MovieCtrl",["$http","$routeParams","$scope","getMovie","tmdb",function(a,b,c,d,e){d.async().then(function(a){c.movie=a.data,c.genres=a.data.genres}),e.getTrailers(b.id).then(function(a){c.trailers=a.results,c.code=a.results[0].key}),e.getReviews(b.id).then(function(a){c.reviews=a.data}),e.getCredits(b.id).then(function(a){c.creditCasts=a.cast,c.creditCrew=a.crew,c.crewProd=[],c.castProd=[],angular.forEach(c.creditCrew,function(a){a.profile_path&&c.crewProd.push(a)}),angular.forEach(c.castProd,function(a){a.profile_path&&c.castProd.push(crew)})}),e.getPerson(b.id).then(function(a){c.person=a}),e.getSimilar(b.id).then(function(a){c.similar=a.results})}]).directive("myYoutube",["$sce",function(a){return{restrict:"EA",scope:{code:"="},replace:!0,template:'<div style="width:100%;height:440px;"><iframe id="movie" type="text/html" width="100%" height="100%" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>',link:function(b){b.$watch("code",function(c){c&&(b.url=a.trustAsResourceUrl("http://www.youtube.com/embed/"+c+"?autoplay=0&color=white&showinfo=0&controls=0&enablejsapi=1"))})}}}]),angular.module("couchtvApp").service("getImages",["$http",function(a){return{async:function(){return a.get("http://api.themoviedb.org/3/movie/popular?api_key=08edb5883bdbd866cb7b58d656f3c66c")}}}]).controller("ImagesCtrl",["$http","$scope","getImages",function(a,b,c){c.async().then(function(a){b.image=a.data,console.log(a.data)})}]),angular.module("couchtvApp").controller("GenreCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getGenreById(b.id).then(function(b){a.moviesByGenre=b.results})}]),angular.module("couchtvApp").controller("DiscoverCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getDiscover().then(function(b){a.the_discoveries=b.results})}]),angular.module("couchtvApp").controller("CoomingsoonCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getUpcoming().then(function(b){a.upComing=b.results})}]),angular.module("couchtvApp").controller("LatestCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getLatest().then(function(b){a.latest=b.results})}]),angular.module("couchtvApp").controller("TopratedCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getTopedRated().then(function(b){a.topRated=b.results})}]),angular.module("couchtvApp").controller("PersonCtrl",["$scope","$routeParams","tmdb",function(a,b,c){c.getPerson(b.id).then(function(b){a.person=b,a.personAge=b.birthday.substring(0,4)}),c.getPersonCredits(b.id).then(function(b){a.personCredits=b.cast,console.log(b)}),a.ageFromYear=function(a){return(new Date).getFullYear()-a}}]);